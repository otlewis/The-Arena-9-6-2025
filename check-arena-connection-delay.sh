#!/bin/bash

echo "üïê Arena Connection Delay Analysis"
echo "==================================="
echo ""
echo "Please run these commands on your server to see what's causing the delay:"
echo ""
echo "1Ô∏è‚É£ Check recent Arena room connections with timestamps:"
echo "   cd /opt/livekit-arena"
echo "   docker-compose logs --tail=200 | grep -E 'arena|ICE|STUN|TURN|candidate|timeout|connect'"
echo ""
echo "2Ô∏è‚É£ Look for ICE gathering delays:"
echo "   docker-compose logs --tail=100 | grep -i 'gathering'"
echo ""
echo "3Ô∏è‚É£ Check TURN server authentication:"
echo "   docker-compose logs --tail=100 | grep -i 'turn.*auth'"
echo ""
echo "4Ô∏è‚É£ Monitor real-time connection as you join Arena:"
echo "   docker-compose logs -f | grep -E 'arena|participant.*joined|ICE'"
echo ""
echo "Common causes of slow connections:"
echo "- ICE gathering timeout (waiting for all candidates)"
echo "- TURN server authentication delays"
echo "- Multiple STUN server timeouts"
echo "- Firewall/NAT traversal retries"
echo "- Server resource constraints"
echo ""
echo "The fact it eventually connects suggests:"
echo "‚úÖ Configuration is correct"
echo "‚ö†Ô∏è But ICE/TURN negotiation is slow"
echo ""
echo "Potential optimizations:"
echo "- Reduce STUN servers to just one reliable one"
echo "- Ensure TURN credentials are correct"
echo "- Check server CPU/memory usage during connection"